
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ColorAid PRO</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#f2f2f2;
    text-align:center;
    padding-bottom:40px;
}

/* HEADER */
header{
    background:#005bbb;
    color:white;
    padding:15px;
    font-size:22px;
    display:flex;
    align-items:center;
    position:sticky;
    top:0;
    z-index:10000;
}
#menuBtn{
    background:none;
    border:none;
    color:white;
    font-size:26px;
    margin-right:15px;
    cursor:pointer;
}

/* STATUS */
#statusIndicator{
    background:#e9ecef;
    padding:8px;
    width:90%;
    max-width:420px;
    margin:10px auto;
    border-radius:5px;
    font-weight:bold;
}

/* MENU */
#menu{
    position:fixed;
    left:0;
    top:0;
    width:75%;
    max-width:260px;
    height:100vh;
    background:white;
    box-shadow:2px 0 12px rgba(0,0,0,.35);
    transform:translateX(-100%);
    transition:.3s;
    padding:20px;
    z-index:9999;
    text-align:left;
}
#menu.open{ transform:translateX(0); }

.menu-btn{
    padding:12px;
    margin:6px 0;
    width:100%;
    border:none;
    border-radius:6px;
    background:#007bff;
    color:white;
    cursor:pointer;
}

/* SECTIONS */
h2{
    color:#005bbb;
    border-bottom:2px solid #005bbb;
    width:90%;
    max-width:420px;
    margin:20px auto 10px;
}

canvas{
    width:100%;
    max-width:360px;
    border-radius:10px;
    box-shadow:0 4px 8px rgba(0,0,0,.1);
}

/* TEST */
#testArea{
    width:90%;
    max-width:380px;
    margin:20px auto;
    padding:15px;
    border:1px dashed #ccc;
    border-radius:8px;
}
</style>
</head>

<body>

<header>
    <button id="menuBtn">‚ò∞</button> ColorAid PRO
</header>

<div id="statusIndicator">Estado: Listo</div>

<!-- MENU -->
<div id="menu">
    <h3>Opciones</h3>
    <button class="menu-btn" onclick="startCamera()">üì∑ Abrir c√°mara</button>
    <button class="menu-btn" onclick="stopCamera()">‚õî Cerrar c√°mara</button>
    <button class="menu-btn" onclick="startTest()">üß† Test Ishihara</button>
    <button class="menu-btn" onclick="toggleMenu()">‚ùå Cerrar men√∫</button>
</div>

<h2>C√°mara</h2>
<canvas id="videoCanvas"></canvas>

<h2>Test Ishihara</h2>
<div id="testArea" style="display:none;">
    <canvas id="testCanvas" width="300" height="300"></canvas><br>
    <input id="testAnswer" type="number" placeholder="N√∫mero">
    <button onclick="submitAnswer()">Responder</button>
</div>

<div id="testResult"></div>

<script>
/* ================= MENU ================= */
const menu=document.getElementById("menu");
document.getElementById("menuBtn").onclick=()=>menu.classList.toggle("open");
function toggleMenu(){ menu.classList.toggle("open"); }

/* ================= C√ÅMARA (FUNCIONAL) ================= */
let stream=null;
const videoCanvas=document.getElementById("videoCanvas");
const vCtx=videoCanvas.getContext("2d");

async function startCamera(){
    try{
        stream=await navigator.mediaDevices.getUserMedia({
            video:{facingMode:"environment"}
        });
        const video=document.createElement("video");
        video.srcObject=stream;
        video.play();
        video.onloadeddata=()=>{
            videoCanvas.width=video.videoWidth;
            videoCanvas.height=video.videoHeight;
            function loop(){
                if(!stream) return;
                vCtx.drawImage(video,0,0);
                requestAnimationFrame(loop);
            }
            loop();
        };
        menu.classList.remove("open");
    }catch(e){
        alert("No se pudo acceder a la c√°mara");
    }
}

function stopCamera(){
    if(stream){
        stream.getTracks().forEach(t=>t.stop());
        stream=null;
        vCtx.clearRect(0,0,videoCanvas.width,videoCanvas.height);
    }
}

/* ================= ISHIHARA (RECORTE) ================= */
/* Imagen collage embebida (la que t√∫ mostraste) */
const ishiharaImg=new Image();
ishiharaImg.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..." 
/* ‚ö†Ô∏è NOTA:
   Por l√≠mite de texto ac√° va recortada.
   EN TU ENTREGA REAL yo te paso el BASE64 COMPLETO
   de la imagen que subiste (Shutterstock con placas).
*/

const plates=[
    {x:0,y:0,s:200,correct:12},
    {x:200,y:0,s:200,correct:8},
    {x:400,y:0,s:200,correct:29},
    {x:0,y:200,s:200,correct:5}
];

let plateIndex=0;
const testCanvas=document.getElementById("testCanvas");
const tCtx=testCanvas.getContext("2d");

function startTest(){
    plateIndex=0;
    document.getElementById("testArea").style.display="block";
    drawPlate();
    menu.classList.remove("open");
}

function drawPlate(){
    const p=plates[plateIndex];
    tCtx.clearRect(0,0,300,300);
    tCtx.drawImage(ishiharaImg,p.x,p.y,p.s,p.s,0,0,300,300);
}

function submitAnswer(){
    const val=parseInt(document.getElementById("testAnswer").value);
    const ok=plates[plateIndex].correct;
    document.getElementById("testResult").textContent=
        val===ok?"‚úÖ Correcto":"‚ùå Incorrecto (era "+ok+")";
    plateIndex++;
    if(plateIndex<plates.length){
        setTimeout(drawPlate,1200);
    }else{
        setTimeout(()=>{
            document.getElementById("testResult").textContent+=" ‚Äî Test finalizado";
            document.getElementById("testArea").style.display="none";
        },1200);
    }
}
</script>

</body>
</html>

