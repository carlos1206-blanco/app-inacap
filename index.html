<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ColorAid PRO</title>

<style>
*{box-sizing:border-box;}
body{margin:0;font-family:Arial;background:#f2f2f2}
header{
    background:#005bbb;color:#fff;padding:15px;
    font-size:22px;display:flex;align-items:center
}
#menuBtn{
    font-size:26px;background:none;border:none;
    color:white;margin-right:15px;cursor:pointer
}

/* PORTADA */
#hero{
    min-height:calc(100vh - 60px);
    background:
        linear-gradient(rgba(0,0,0,.45), rgba(0,0,0,.45)),
        url("https://images.unsplash.com/photo-1500530855697-b586d89ba3ee");
    background-size:cover;
    background-position:center;
    color:white;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    text-align:center;
    padding:30px;
}
#hero h1{font-size:32px;margin-bottom:10px}
#hero p{max-width:500px;font-size:16px;opacity:.9}
#hero button{
    margin-top:20px;
    padding:14px 30px;
    font-size:18px;
    border:none;
    border-radius:30px;
    background:#28a745;
    color:white;
    cursor:pointer;
}

/* overlay + menu */
#overlay{
    display:none;position:fixed;inset:0;
    background:rgba(0,0,0,.4);z-index:900
}
#menu{
    position:fixed;top:0;left:-260px;width:260px;height:100vh;
    background:#fff;padding:20px;
    box-shadow:2px 0 10px rgba(0,0,0,.3);
    transition:.3s;z-index:1000
}
#menu.open{left:0}

.menu-title{font-weight:bold;margin:15px 0 5px}
.menu-btn{
    width:100%;padding:10px;margin:4px 0;
    border:none;border-radius:5px;
    background:#007bff;color:white;cursor:pointer
}
.menu-btn.close{background:#dc3545}

main{text-align:center;padding:20px}

#canvas{
    display:none;margin:15px auto;
    max-width:360px;width:100%;
    border-radius:10px;
    box-shadow:0 4px 8px rgba(0,0,0,.2)
}

/* test */
#testArea{display:none;margin-top:20px}
#testCanvas{
    width:300px;height:300px;border-radius:50%;
    box-shadow:0 4px 8px rgba(0,0,0,.2)
}

input[type=file]{display:none}
input[type=number]{padding:8px;width:150px}
</style>
</head>

<body>

<header>
    <button id="menuBtn">‚ò∞</button>
    ColorAid PRO
</header>

<!-- PORTADA -->
<section id="hero">
    <h1>ColorAid PRO</h1>
    <p>
        Herramienta de simulaci√≥n crom√°tica y test de percepci√≥n del color.
        Uso educativo y demostrativo.
    </p>
    <button onclick="hideHero()">Comenzar</button>
</section>

<div id="overlay"></div>

<div id="menu">
    <button class="menu-btn close" onclick="closeMenu()">‚ùå Cerrar</button>

    <div class="menu-title">Imagen</div>
    <button class="menu-btn" onclick="imageInput.click();hideHero()">üìÅ Subir imagen</button>

    <div class="menu-title">Filtros</div>
    <button class="menu-btn" onclick="setFilter(null)">Visi√≥n normal</button>
    <button class="menu-btn" onclick="setFilter('deuteranopia')">Deuteranopia</button>
    <button class="menu-btn" onclick="setFilter('protanopia')">Protanopia</button>
    <button class="menu-btn" onclick="setFilter('tritanopia')">Tritanopia</button>

    <div class="menu-title">C√°mara</div>
    <button class="menu-btn" onclick="startCamera();hideHero()">üì∑ Abrir c√°mara</button>
    <button class="menu-btn close" onclick="stopCamera()">‚õî Cerrar c√°mara</button>

    <div class="menu-title">Test</div>
    <button class="menu-btn" onclick="startTest();hideHero()">üß† Test crom√°tico</button>
</div>

<main>
    <input type="file" id="imageInput" accept="image/*">
    <canvas id="canvas"></canvas>

    <div id="testArea">
        <h3>Test de percepci√≥n crom√°tica</h3>
        <canvas id="testCanvas" width="300" height="300"></canvas><br>
        <input id="answer" type="number" placeholder="N√∫mero que ves"><br><br>
        <button class="menu-btn" onclick="submitAnswer()">Responder</button>
        <button class="menu-btn close" onclick="closeTest()">Cerrar test</button>
    </div>

    <div id="result"></div>
</main>

<script>
// ===== PORTADA =====
function hideHero(){
    document.getElementById("hero").style.display="none";
}

// ===== MEN√ö =====
menuBtn.onclick=()=>{menu.classList.add("open");overlay.style.display="block"}
overlay.onclick=closeMenu
function closeMenu(){menu.classList.remove("open");overlay.style.display="none"}

// ===== FILTROS (MATRICES REALES) =====
let filter=null
const colorMatrices={
 deuteranopia:[[0.625,0.375,0],[0.7,0.3,0],[0,0.3,0.7]],
 protanopia:[[0.567,0.433,0],[0.558,0.442,0],[0,0.242,0.758]],
 tritanopia:[[0.95,0.05,0],[0,0.433,0.567],[0,0.475,0.525]]
}
function setFilter(f){filter=f;applyFilter();closeMenu()}

// ===== CANVAS PRINCIPAL =====
const canvas=document.getElementById("canvas")
const ctx=canvas.getContext("2d")
let originalImage=null

// ===== SUBIR IMAGEN =====
imageInput.onchange=e=>{
 const r=new FileReader()
 r.onload=()=>{
  const img=new Image()
  img.onload=()=>{
   canvas.style.display="block"
   canvas.width=img.width
   canvas.height=img.height
   ctx.drawImage(img,0,0)
   originalImage=ctx.getImageData(0,0,canvas.width,canvas.height)
   applyFilter()
  }
  img.src=r.result
 }
 r.readAsDataURL(e.target.files[0])
 closeMenu()
}

// ===== APLICAR FILTRO REAL =====
function applyFilter(){
 if(!originalImage)return
 ctx.putImageData(originalImage,0,0)
 if(!filter)return
 const m=colorMatrices[filter]
 let img=ctx.getImageData(0,0,canvas.width,canvas.height)
 let d=img.data
 for(let i=0;i<d.length;i+=4){
  let r=d[i],g=d[i+1],b=d[i+2]
  d[i]=Math.min(255,r*m[0][0]+g*m[0][1]+b*m[0][2])
  d[i+1]=Math.min(255,r*m[1][0]+g*m[1][1]+b*m[1][2])
  d[i+2]=Math.min(255,r*m[2][0]+g*m[2][1]+b*m[2][2])
 }
 ctx.putImageData(img,0,0)
}

// ===== C√ÅMARA =====
let stream=null
async function startCamera(){
 try{
  stream=await navigator.mediaDevices.getUserMedia({video:true})
  const v=document.createElement("video")
  v.srcObject=stream
  v.play()
  v.onloadedmetadata=()=>{
   canvas.style.display="block"
   canvas.width=v.videoWidth
   canvas.height=v.videoHeight
   function loop(){
    if(!stream)return
    ctx.drawImage(v,0,0)
    originalImage=ctx.getImageData(0,0,canvas.width,canvas.height)
    applyFilter()
    requestAnimationFrame(loop)
   }
   loop()
  }
  closeMenu()
 }catch{alert("No se pudo acceder a la c√°mara")}
}
function stopCamera(){if(stream){stream.getTracks().forEach(t=>t.stop());stream=null}}

// ===== TEST CROM√ÅTICO =====
const plates=[
 {number:12,fg:[220,60,60],bg:[80,170,80]},
 {number:8, fg:[60,180,60],bg:[200,90,90]},
 {number:29,fg:[60,90,200],bg:[200,200,80]}
]
let idx=0
const tCtx=testCanvas.getContext("2d")

function drawPlate(p){
 tCtx.clearRect(0,0,300,300)
 for(let i=0;i<1600;i++){
  let c=Math.random()<0.35?p.fg:p.bg
  tCtx.fillStyle=`rgb(${c[0]},${c[1]},${c[2]})`
  tCtx.beginPath()
  tCtx.arc(Math.random()*300,Math.random()*300,Math.random()*5+3,0,Math.PI*2)
  tCtx.fill()
 }
 tCtx.globalCompositeOperation="destination-in"
 tCtx.font="bold 110px Arial"
 tCtx.textAlign="center"
 tCtx.textBaseline="middle"
 tCtx.fillText(p.number,150,150)
 tCtx.globalCompositeOperation="source-over"
}
function startTest(){
 idx=0;answer.value="";result.textContent=""
 testArea.style.display="block"
 drawPlate(plates[idx])
 closeMenu()
}
function submitAnswer(){
 const ok=plates[idx].number
 result.textContent=answer.value==ok?"‚úÖ Correcto":"‚ùå Incorrecto (era "+ok+")"
 idx++;answer.value=""
 if(idx<plates.length)setTimeout(()=>drawPlate(plates[idx]),1200)
 else setTimeout(()=>result.textContent+=" ‚Äî Test finalizado",1200)
}
function closeTest(){testArea.style.display="none"}
</script>

</body>
</html>



