<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ColorAid PRO</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#f2f2f2;
    text-align:center;
    padding-bottom:40px;
}

/* HEADER */
header{
    background:#005bbb;
    color:white;
    padding:15px;
    font-size:22px;
    display:flex;
    align-items:center;
    position:sticky;
    top:0;
    z-index:10000;
}
#menuBtn{
    background:none;
    border:none;
    color:white;
    font-size:26px;
    margin-right:15px;
    cursor:pointer;
}

/* STATUS */
#statusIndicator{
    background:#e9ecef;
    padding:8px;
    width:90%;
    max-width:400px;
    margin:10px auto;
    border-radius:5px;
    font-weight:bold;
}

/* MENU */
#menu{
    position:fixed;
    left:0;
    top:0;
    width:75%;
    max-width:260px;
    height:100vh;
    background:white;
    box-shadow:2px 0 12px rgba(0,0,0,.35);
    transform:translateX(-100%);
    transition:transform .3s ease;
    padding:20px;
    z-index:9999;
    text-align:left;
}
#menu.open{ transform:translateX(0); }

.mode-btn{
    border-left:6px solid #007bff;
    padding:12px;
    margin:6px 0;
    cursor:pointer;
}

/* SECTIONS */
h2{
    color:#005bbb;
    border-bottom:2px solid #005bbb;
    width:90%;
    max-width:400px;
    margin:20px auto 10px;
}
button{
    padding:12px;
    margin:8px;
    width:90%;
    max-width:300px;
    border:none;
    border-radius:10px;
    font-size:16px;
    background:#007bff;
    color:white;
}
canvas{ width:100%; }

#testArea{
    width:90%;
    max-width:380px;
    margin:20px auto;
    padding:15px;
    border:1px dashed #ccc;
    border-radius:8px;
}
</style>
</head>

<body>

<header>
    <button id="menuBtn">☰</button> ColorAid PRO
</header>

<div id="statusIndicator">Filtro Activo: Ninguno</div>

<div id="menu">
    <h3>Filtros</h3>
    <div class="mode-btn" onclick="setFilter('deuteranopia')">Deuteranopia</div>
    <div class="mode-btn" onclick="setFilter('protanopia')">Protanopia</div>
    <div class="mode-btn" onclick="setFilter('tritanopia')">Tritanopia</div>
    <div class="mode-btn" onclick="setFilter(null)">Desactivar</div>
    <hr>
    <button onclick="startTest()">Test Ishihara</button>
    <button onclick="toggleMenu()">Cerrar</button>
</div>

<h2>Test Ishihara (educativo)</h2>
<div id="testArea" style="display:none;">
    <canvas id="testCanvas" width="300" height="300"></canvas><br>
    <input id="testAnswer" type="number" placeholder="Número">
    <button onclick="submitAnswer()">Responder</button>
</div>

<div id="testResult"></div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

/* MENU */
const menu=document.getElementById("menu");
document.getElementById("menuBtn").onclick=()=>menu.classList.toggle("open");
window.toggleMenu=()=>menu.classList.toggle("open");

/* FILTROS */
let selectedMatrix=null;
const matrices={
    deuteranopia:[[0.625,0.375,0],[0.7,0.3,0],[0,0.3,0.7]],
    protanopia:[[0.567,0.433,0],[0.558,0.442,0],[0,0.242,0.758]],
    tritanopia:[[0.95,0.05,0],[0,0.433,0.567],[0,0.475,0.525]]
};
window.setFilter=(t)=>{
    selectedMatrix=t?matrices[t]:null;
    document.getElementById("statusIndicator").textContent=
        "Filtro Activo: "+(t??"Ninguno");
};

/* ISHIHARA EDU */
const plates=[12,8,29,5];
let idx=0;
const canvas=document.getElementById("testCanvas");
const ctx=canvas.getContext("2d");

function drawPlate(n){
    ctx.clearRect(0,0,300,300);
    for(let i=0;i<1200;i++){
        ctx.fillStyle=`hsl(${Math.random()*360},70%,60%)`;
        ctx.beginPath();
        ctx.arc(Math.random()*300,Math.random()*300,6,0,Math.PI*2);
        ctx.fill();
    }
    ctx.fillStyle="black";
    ctx.font="bold 80px Arial";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText(n,150,150);
}

window.startTest=()=>{
    idx=0;
    document.getElementById("testArea").style.display="block";
    drawPlate(plates[idx]);
    menu.classList.remove("open");
};

window.submitAnswer=()=>{
    const val=parseInt(document.getElementById("testAnswer").value);
    const ok=plates[idx];
    document.getElementById("testResult").textContent=
        val===ok?"✅ Correcto":"❌ Incorrecto (era "+ok+")";
    idx++;
    if(idx<plates.length){
        setTimeout(()=>drawPlate(plates[idx]),1200);
    }else{
        setTimeout(()=>{
            document.getElementById("testResult").textContent+=" — Test finalizado";
            document.getElementById("testArea").style.display="none";
        },1200);
    }
};

});
</script>

</body>
</html>


